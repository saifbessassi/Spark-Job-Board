<!-- <sp-spinner *ngIf="isLoading"></sp-spinner> -->
<div class="px-3">
    <div class="modal-header border-none pb-0">
        <h4 class="modal-title" id="modal-basic-title">{{'IDENTITY.INFO' | translate}}</h4>
        <button type="button" class="close" aria-label="Close" (click)="dismissModal()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <section class="mt-4">
        <div class="row">
            <div class="col justify-content-center text-center">
                <h6  class="text-danger mb-4" *ngIf="errorMsg">{{errorMsg}}</h6>
                <div class="row justify-content-center mb-3">
                    <img *ngIf="!previewPicture && !identity?.picture" src="assets/images/default-avatar.svg" alt="">
                    <img
                        *ngIf="!previewPicture && identity?.picture && !identity?.picture.url.includes('http')"
                        src="http://localhost:8000{{identity?.picture.url}}" alt="">
                    <img
                        *ngIf="!previewPicture && identity?.picture && identity?.picture.url.includes('http')"
                        src="{{identity?.picture.url}}" alt="">
                    <img *ngIf="previewPicture" [src]="previewPicture" alt="">
                </div>
                <div class="row justify-content-center mb-3" *ngIf="isUploading">
                    <div class="col-4">
                        <ngb-progressbar [value]="uploadProgress"></ngb-progressbar>
                    </div>
                </div>
                <div class="row justify-content-center mb-3 d-block">
                    <p class="mb-0">
                        <small>{{'IDENTITY.PHOTO_MAX_SIZE' | translate}} : 1 MB</small>
                    </p>
                    <p class="mb-0">
                        <small>{{'IDENTITY.PHOTO_FORMAT' | translate}} : JPG, PNG</small>
                    </p>
                </div>
                <form>
                    <div class="form-group">
                        <input
                            (change)="preview($event)"
                            style="display: none;"
                            type="file"
                            accept="image/png, image/jpeg"
                            #fileInput>
                    </div>
                
                    <div class="row justify-content-center">
                        <button 
                            class="btn btn-outline-primary btn-picture"
                            (click)="fileInput.click()"
                            [disabled]="isUploading">
                            <i class="fas fa-cog"></i> {{'IDENTITY.MODIFY' | translate}}
                        </button>
                        <button 
                            (click)="savePicture()"
                            class="btn btn-outline-success btn-picture" 
                            [disabled]="!previewPicture || isUploading">
                            <i class="fas fa-pen"></i> {{'SAVE' | translate}}
                        </button>
                        <button 
                            (click)="deletePicture()"
                            class="btn btn-outline-danger btn-picture"
                            [disabled]="isUploading || !identity?.picture">
                            <i class="fas fa-trash"></i> {{'IDENTITY.DELETE' | translate}}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <hr>

    <form [formGroup]="identityForm" (ngSubmit)="save()">
    
        <div class="modal-body">
            <div class="form-group">
                <label for="inputFullname">{{'IDENTITY.FULLNAME' | translate}}: <span class="obligatory">*</span></label>
                <input
                    formControlName="fullname"
                    type="text" 
                    class="form-control"
                    pattern="[a-zA-Z]+\s[a-zA-Z]+(\s[a-zA-Z]+)?"
                    [ngClass]="{'is-valid': identityForm.get('fullname').valid,
                                'is-invalid': !identityForm.get('fullname').valid && identityForm.get('fullname').touched}">
                <div class="invalid-feedback mt-3" *ngIf="identityForm.get('fullname').errors?.required">
                    {{'IDENTITY.FULLNAME_REQUIRED' | translate}}.
                </div>
                <div class="invalid-feedback mt-3" *ngIf="identityForm.get('fullname').errors?.pattern">
                    {{'IDENTITY.FULLNAME_FORMAT' | translate}} !
                </div>
                <div class="invalid-feedback mt-3" *ngIf="identityForm.get('fullname').errors?.maxlength">
                    {{'IDENTITY.FULLNAME_MAX' | translate}}.
                </div>
            </div>
            <div class="form-group">
                <label for="inputAddress">{{'IDENTITY.ADDRESS' | translate}}:</label>
                <input
                    formControlName="address"
                    placeholder="{{'IDENTITY.ADDRESS_PLACEHOLDER' | translate}}"
                    type="text" 
                    class="form-control"
                    [ngClass]="{'is-valid': identityForm.get('address').valid,
                                'is-invalid': !identityForm.get('address').valid && identityForm.get('address').touched}">
                <div class="invalid-feedback mt-3" *ngIf="identityForm.get('address').errors?.minlength">
                    {{'IDENTITY.ADDRESS_MIN' | translate}}.
                </div>
                <div class="invalid-feedback mt-3" *ngIf="identityForm.get('address').errors?.maxlength">
                    {{'IDENTITY.ADDRESS_MAX' | translate}}.
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="inputPhone">{{'IDENTITY.PHONE' | translate}}: <span class="obligatory">*</span></label>
                    <input
                        formControlName="phone"
                        placeholder="{{'IDENTITY.PHONE_PLACEHOLDER' | translate}}"
                        type="text" 
                        class="form-control"
                        pattern="[0-9]+"
                        [ngClass]="{'is-valid': identityForm.get('phone').valid,
                                'is-invalid': !identityForm.get('phone').valid && 
                                (identityForm.get('phone').touched || identityForm.get('phone').value)}">
                    <div class="invalid-feedback mt-3" *ngIf="identityForm.get('phone').errors?.required">
                        {{'IDENTITY.PHONE_REQUIRED' | translate}}.
                    </div>
                    <div class="invalid-feedback mt-3" *ngIf="identityForm.get('phone').errors?.pattern">
                        {{'IDENTITY.PHONE_VALID' | translate}}.
                    </div>
                    <div class="invalid-feedback mt-3" *ngIf="identityForm.get('phone').errors?.minlength || identityForm.get('phone').errors?.maxlength">
                        {{'IDENTITY.PHONE_LENGTH' | translate}}.
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label for="inputPassword4">{{'IDENTITY.SENIORITY' | translate}}:</label>
                    <select 
                        formControlName="seniorityLevel"
                        class="form-control"
                        [ngClass]="{'is-valid': identityForm.get('seniorityLevel').valid,
                                'is-invalid': !identityForm.get('seniorityLevel').valid && identityForm.get('seniorityLevel').touched}"
                    >
                        <option>0 {{'IDENTITY.TO' | translate}} 2 {{'IDENTITY.YEARS' | translate}}</option>
                        <option>3 {{'IDENTITY.TO' | translate}} 5 {{'IDENTITY.YEARS' | translate}}</option>
                        <option>6 {{'IDENTITY.TO' | translate}} 9 {{'IDENTITY.YEARS' | translate}}</option>
                        <option>10 {{'IDENTITY.YEARSORMORE' | translate}}</option>
                    </select>
                    <div class="invalid-feedback mt-3" *ngIf="identityForm.get('seniorityLevel').errors?.required">
                        {{'IDENTITY.EXPERIENCE_REQUIRED' | translate}}.
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer border-none pt-0">
            <button type="submit" class="btn sp-btn-red"[disabled]="!identityForm.valid || isLoading">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                {{'SAVE' | translate}}
            </button>
        </div>

    </form>
</div>