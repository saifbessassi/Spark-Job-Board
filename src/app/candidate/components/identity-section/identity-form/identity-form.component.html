<sp-spinner *ngIf="isLoading"></sp-spinner>
<div class="px-3">
    <div class="modal-header border-none pb-0">
        <h4 class="modal-title" id="modal-basic-title">General Information</h4>
        <button type="button" class="close" aria-label="Close" (click)="dismissModal()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <section class="mt-4">
        <div class="row">
            <div class="col justify-content-center text-center">
                <h6  class="text-danger mb-4" *ngIf="error_msg">{{error_msg}}</h6>
                <div class="row justify-content-center mb-3">
                    <img *ngIf="!previewPicture && !identity?.picture" src="assets/images/default-avatar.svg" alt="">
                    <img
                        *ngIf="!previewPicture && identity?.picture && !identity?.picture.url.includes('http')"
                        src="http://localhost:8000{{identity?.picture.url}}" alt="">
                    <img
                        *ngIf="!previewPicture && identity?.picture && identity?.picture.url.includes('http')"
                        src="{{identity?.picture.url}}" alt="">
                    <img *ngIf="previewPicture" [src]="previewPicture" alt="">
                </div>
                <div class="row justify-content-center mb-3" *ngIf="isUploading">
                    <div class="col-4">
                        <ngb-progressbar [value]="uploadProgress"></ngb-progressbar>
                    </div>
                </div>
                <div class="row justify-content-center mb-3 d-block">
                    <p class="mb-0">
                        <small>Maximum size : 1 MB</small>
                    </p>
                    <p class="mb-0">
                        <small>Format : JPG, PNG</small>
                    </p>
                </div>
                <form>
                    <div class="form-group">
                        <input
                            (change)="preview($event)"
                            style="display: none;"
                            type="file"
                            accept="image/png, image/jpeg"
                            #fileInput>
                    </div>
                
                    <div class="row justify-content-center">
                        <button 
                            class="btn btn-outline-primary btn-picture"
                            (click)="fileInput.click()"
                            [disabled]="isUploading">
                            <i class="fas fa-cog"></i> Modify
                        </button>
                        <button 
                            (click)="savePicture()"
                            class="btn btn-outline-success btn-picture" 
                            [disabled]="!previewPicture || isUploading">
                            <i class="fas fa-pen"></i> Save
                        </button>
                        <button 
                            (click)="deletePicture()"
                            class="btn btn-outline-danger btn-picture"
                            [disabled]="isUploading || !identity?.picture">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <hr>

    <form [formGroup]="identityForm" (ngSubmit)="save()">
    
        <div class="modal-body">
            <div class="form-group">
                <label for="inputFullname">Full name: <span class="obligatory">*</span></label>
                <input
                    formControlName="fullname"
                    type="text" 
                    class="form-control"
                    pattern="[a-zA-Z]+\s[a-zA-Z]+(\s[a-zA-Z]+)?"
                    [ngClass]="{'is-valid': identityForm.get('fullname').valid,
                                'is-invalid': !identityForm.get('fullname').valid && identityForm.get('fullname').touched}">
                <div class="invalid-feedback mt-3" *ngIf="identityForm.get('fullname').errors?.required">
                    Full name is required.
                </div>
                <div class="invalid-feedback mt-3" *ngIf="identityForm.get('fullname').errors?.pattern">
                    Full name must contains 2 or 3 words and only alphabetic characters !
                </div>
                <div class="invalid-feedback mt-3" *ngIf="identityForm.get('fullname').errors?.maxlength">
                    Full name can contain maximum 255 characters.
                </div>
            </div>
            <div class="form-group">
                <label for="inputAddress">Current address:</label>
                <input
                    formControlName="address"
                    placeholder="Your current address"
                    type="text" 
                    class="form-control"
                    [ngClass]="{'is-valid': identityForm.get('address').valid,
                                'is-invalid': !identityForm.get('address').valid && identityForm.get('address').touched}">
                <div class="invalid-feedback mt-3" *ngIf="identityForm.get('address').errors?.minlength">
                    Current address must be at least 3 characters.
                </div>
                <div class="invalid-feedback mt-3" *ngIf="identityForm.get('address').errors?.maxlength">
                    Current address can contain maximum 255 characters.
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="inputPhone">Phone number: <span class="obligatory">*</span></label>
                    <input
                        formControlName="phone"
                        placeholder="Your current phone number"
                        type="text" 
                        class="form-control"
                        pattern="[0-9]+"
                        [ngClass]="{'is-valid': identityForm.get('phone').valid,
                                'is-invalid': !identityForm.get('phone').valid && 
                                (identityForm.get('phone').touched || identityForm.get('phone').value)}">
                    <div class="invalid-feedback mt-3" *ngIf="identityForm.get('phone').errors?.required">
                        Phone number is required.
                    </div>
                    <div class="invalid-feedback mt-3" *ngIf="identityForm.get('phone').errors?.pattern">
                        Phone number is not valid.
                    </div>
                    <div class="invalid-feedback mt-3" *ngIf="identityForm.get('phone').errors?.minlength || identityForm.get('phone').errors?.maxlength">
                        Phone number must contain 8 characters.
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label for="inputPassword4">Seniority Level:</label>
                    <select 
                        formControlName="seniorityLevel"
                        class="form-control"
                        [ngClass]="{'is-valid': identityForm.get('seniorityLevel').valid,
                                'is-invalid': !identityForm.get('seniorityLevel').valid && identityForm.get('seniorityLevel').touched}"
                    >
                        <option>0 to 2 years</option>
                        <option>3 to 5 years</option>
                        <option>6 to 9 years</option>
                        <option>10 years or more</option>
                    </select>
                    <div class="invalid-feedback mt-3" *ngIf="identityForm.get('seniorityLevel').errors?.required">
                        Seniority Level is required.
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer border-none pt-0">
            <button type="submit" class="btn sp-btn-red"[disabled]="!identityForm.valid">Save</button>
        </div>

    </form>
</div>